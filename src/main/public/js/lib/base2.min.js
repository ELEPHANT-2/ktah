/*
  base2 - copyright 2007-2011, Dean Edwards
  http://code.google.com/p/base2/
  http://www.opensource.org/licenses/mit-license.php

  Contributors:
    Doeke Zanstra
*/

var base2={name:"base2",version:"1.0.2",exports:"Base,Package,Abstract,Module,Enumerable,Map,Collection,RegGrp,"+"Undefined,Null,This,True,False,assignID,detect,global",namespace:""};new function(_no_shrink_){var Undefined=K(),Null=K(null),True=K(true),False=K(false),This=function(){return this};var global=This();var base2=global.base2;var _FORMAT=/%([1-9])/g;var _LTRIM=/^\s\s*/;var _RTRIM=/\s\s*$/;var _RESCAPE=/([\/()[\]{}|*+-.,^$?\\])/g;var _BASE=/try/.test(detect)?/\bbase\b/:/.*/;var _HIDDEN=["constructor","toString","valueOf"];var _MSIE_NATIVE_FUNCTION=detect("(jscript)")?new RegExp("^"+rescape(isNaN).replace(/isNaN/,"\\w+")+"$"):{test:False};var _counter=1;var _slice=Array.prototype.slice;_Function_forEach();function assignID(object){if(!object.base2ID)object.base2ID="b2_"+_counter++;return object.base2ID;};var _subclass=function(_instance,_static){base2.__prototyping=this.prototype;var _prototype=new this;if(_instance)extend(_prototype,_instance);delete base2.__prototyping;var _constructor=_prototype.constructor;function _class(){if(!base2.__prototyping){if(this.constructor==arguments.callee||this.__constructing){this.__constructing=true;_constructor.apply(this,arguments);delete this.__constructing;}else{return extend(arguments[0],_prototype);}}return this;};_prototype.constructor=_class;for(var i in Base)_class[i]=this[i];_class.ancestor=this;_class.base=Undefined;if(_static)extend(_class,_static);_class.prototype=_prototype;if(_class.init)_class.init();;;;_class["#implements"]=[];;;;_class["#implemented_by"]=[];return _class;};var Base=_subclass.call(Object,{constructor:function(){if(arguments.length>0){this.extend(arguments[0]);}},base:function(){},extend:delegate(extend)},Base={ancestorOf:function(klass){return _ancestorOf(this,klass);},extend:_subclass,forEach:function(object,block,context){_Function_forEach(this,object,block,context);},implement:function(source){if(typeof source=="function"){;;;if(_ancestorOf(Base,source)){;;;this["#implements"].push(source);;;;source["#implemented_by"].push(this);;;;}source=source.prototype;}extend(this.prototype,source);return this;}});var Package=Base.extend({constructor:function(_private,_public){this.extend(_public);if(this.init)this.init();if(this.name&&this.name!="base2"){if(!this.parent)this.parent=base2;this.parent.addName(this.name,this);this.namespace=format("var %1=%2;",this.name,String2.slice(this,1,-1));}if(_private){var JSNamespace=base2.JavaScript?base2.JavaScript.namespace:"";_private.imports=Array2.reduce(csv(this.imports),function(namespace,name){var ns=lookup(name)||lookup("JavaScript."+name);;;;assert(ns,format("Object not found: '%1'.",name),ReferenceError);return namespace+=ns.namespace;},"var base2=(function(){return this.base2})();"+base2.namespace+JSNamespace)+lang.namespace;_private.exports=Array2.reduce(csv(this.exports),function(namespace,name){var fullName=this.name+"."+name;this.namespace+="var "+name+"="+fullName+";";return namespace+="if(!"+fullName+")"+fullName+"="+name+";";},"",this)+"this._label_"+this.name+"();";var pkg=this;var packageName=String2.slice(this,1,-1);_private["_label_"+this.name]=function(){Package.forEach(pkg,function(object,name){if(object&&object.ancestorOf==Base.ancestorOf){object.toString=K(format("[%1.%2]",packageName,name));if(object.prototype.toString==Base.prototype.toString){object.prototype.toString=K(format("[object %1.%2]",packageName,name));}}});};}function lookup(names){names=names.split(".");var value=base2,i=0;while(value&&names[i]!=null){value=value[names[i++]];}return value;};},exports:"",imports:"",name:"",namespace:"",parent:null,addName:function(name,value){if(!this[name]){this[name]=value;this.exports+=","+name;this.namespace+=format("var %1=%2.%1;",name,this.name);}},addPackage:function(name){this.addName(name,new Package(null,{name:name,parent:this}));},toString:function(){return format("[%1]",this.parent?String2.slice(this.parent,1,-1)+"."+this.name:this.name);}});var Abstract=Base.extend({constructor:function(){throw new TypeError("Abstract class cannot be instantiated.");}});var _moduleCount=0;var Module=Abstract.extend(null,{namespace:"",extend:function(_interface,_static){var module=this.base();var index=_moduleCount++;module.namespace="";module.partial=this.partial;module.toString=K("[base2.Module["+index+"]]");Module[index]=module;module.implement(this);if(_interface)module.implement(_interface);if(_static){extend(module,_static);if(module.init)module.init();}return module;},forEach:function(block,context){_Function_forEach(Module,this.prototype,function(method,name){if(typeOf(method)=="function"){block.call(context,this[name],name,this);}},this);},implement:function(_interface){var module=this;var id=module.toString().slice(1,-1);if(typeof _interface=="function"){if(!_ancestorOf(_interface,module)){this.base(_interface);}if(_ancestorOf(Module,_interface)){for(var name in _interface){if(module[name]===undefined){var property=_interface[name];if(typeof property=="function"&&property.call&&_interface.prototype[name]){property=_staticModuleMethod(_interface,name);}module[name]=property;}}module.namespace+=_interface.namespace.replace(/base2\.Module\[\d+\]/g,id);}}else{extend(module,_interface);_extendModule(module,_interface);}return module;},partial:function(){var module=Module.extend();var id=module.toString().slice(1,-1);module.namespace=this.namespace.replace(/(\w+)=b[^\)]+\)/g,"$1="+id+".$1");this.forEach(function(method,name){module[name]=partial(bind(method,module));});return module;}});function _extendModule(module,_interface){var proto=module.prototype;var id=module.toString().slice(1,-1);for(var name in _interface){var property=_interface[name],namespace="";if(name.charAt(0)=="@"){if(detect(name.slice(1)))_extendModule(module,property);}else if(!proto[name]){if(name==name.toUpperCase()){namespace="var "+name+"="+id+"."+name+";";}else if(typeof property=="function"&&property.call){namespace="var "+name+"=base2.lang.bind('"+name+"',"+id+");";proto[name]=_moduleMethod(module,name);;;;proto[name]._module=module;}if(module.namespace.indexOf(namespace)==-1){module.namespace+=namespace;}}}};function _staticModuleMethod(module,name){return function(){return module[name].apply(module,arguments);};};function _moduleMethod(module,name){return function(){var args=_slice.call(arguments);args.unshift(this);return module[name].apply(module,args);};};var Enumerable=Module.extend({every:function(object,test,context){var result=true;try{forEach(object,function(value,key){result=test.call(context,value,key,object);if(!result)throw StopIteration;});}catch(error){if(error!=StopIteration)throw error;}return!!result;},filter:function(object,test,context){var i=0;return this.reduce(object,function(result,value,key){if(test.call(context,value,key,object)){result[i++]=value;}return result;},[]);},invoke:function(object,method){var args=_slice.call(arguments,2);return this.map(object,(typeof method=="function")?function(item){return item==null?undefined:method.apply(item,args);}:function(item){return item==null?undefined:item[method].apply(item,args);});},map:function(object,block,context){var result=[],i=0;forEach(object,function(value,key){result[i++]=block.call(context,value,key,object);});return result;},pluck:function(object,key){return this.map(object,function(item){return item==null?undefined:item[key];});},reduce:function(object,block,result,context){var initialised=arguments.length>2;forEach(object,function(value,key){if(initialised){result=block.call(context,result,value,key,object);}else{result=value;initialised=true;}});return result;},some:function(object,test,context){return!this.every(object,not(test),context);}});var _HASH="#";var Map=Base.extend({constructor:function(values){if(values)this.merge(values);},clear:function(){for(var key in this)if(key.indexOf(_HASH)==0){delete this[key];}},copy:function(){base2.__prototyping=true;var copy=new this.constructor;delete base2.__prototyping;for(var i in this)if(this[i]!==copy[i]){copy[i]=this[i];}return copy;},forEach:function(block,context){for(var key in this)if(key.indexOf(_HASH)==0){block.call(context,this[key],key.slice(1),this);}},get:function(key){return this[_HASH+key];},getKeys:function(){return this.map(II);},getValues:function(){return this.map(I);},has:function(key){return _HASH+key in this;},merge:function(values){var put=flip(this.put);forEach(arguments,function(values){forEach(values,put,this);},this);return this;},put:function(key,value){this[_HASH+key]=value;},remove:function(key){delete this[_HASH+key];},size:function(){var size=0;for(var key in this)if(key.indexOf(_HASH)==0)size++;return size;},union:function(values){return this.merge.apply(this.copy(),arguments);}});Map.implement(Enumerable);Map.prototype.filter=function(test,context){return this.reduce(function(result,value,key){if(!test.call(context,value,key,this)){result.remove(key);}return result;},this.copy(),this);};var _KEYS="~";var Collection=Map.extend({constructor:function(values){this[_KEYS]=new Array2;this.base(values);},add:function(key,item){assert(!this.has(key),"Duplicate key '"+key+"'.");this.put.apply(this,arguments);},clear:function(){this.base();this[_KEYS].length=0;},copy:function(){var copy=this.base();copy[_KEYS]=this[_KEYS].copy();return copy;},forEach:function(block,context){var keys=this[_KEYS];var length=keys.length;for(var i=0;i<length;i++){block.call(context,this[_HASH+keys[i]],keys[i],this);}},getAt:function(index){var key=this[_KEYS].item(index);return(key===undefined)?undefined:this[_HASH+key];},getKeys:function(){return this[_KEYS].copy();},indexOf:function(key){return this[_KEYS].indexOf(String(key));},insertAt:function(index,key,item){assert(this[_KEYS].item(index)!==undefined,"Index out of bounds.");assert(!this.has(key),"Duplicate key '"+key+"'.");this[_KEYS].insertAt(index,String(key));this[_HASH+key]=null;this.put.apply(this,_slice.call(arguments,1));},item:function(keyOrIndex){return this[typeof keyOrIndex=="number"?"getAt":"get"](keyOrIndex);},put:function(key,item){if(!this.has(key)){this[_KEYS].push(String(key));}var klass=this.constructor;if(klass.Item&&!instanceOf(item,klass.Item)){item=klass.create.apply(klass,arguments);}this[_HASH+key]=item;},putAt:function(index,item){arguments[0]=this[_KEYS].item(index);assert(arguments[0]!==undefined,"Index out of bounds.");this.put.apply(this,arguments);},remove:function(key){if(this.has(key)){this[_KEYS].remove(String(key));delete this[_HASH+key];}},removeAt:function(index){var key=this[_KEYS].item(index);if(key!==undefined){this[_KEYS].removeAt(index);delete this[_HASH+key];}},reverse:function(){this[_KEYS].reverse();return this;},size:function(){return this[_KEYS].length;},slice:function(start,end){var sliced=this.copy();if(arguments.length>0){var keys=this[_KEYS],removed=keys;sliced[_KEYS]=Array2(_slice.apply(keys,arguments));if(sliced[_KEYS].length){removed=removed.slice(0,start);if(arguments.length>1){removed=removed.concat(keys.slice(end));}}for(var i=0;i<removed.length;i++){delete sliced[_HASH+removed[i]];}}return sliced;},sort:function(compare){if(compare){this[_KEYS].sort(bind(function(key1,key2){return compare(this[_HASH+key1],this[_HASH+key2],key1,key2);},this));}else this[_KEYS].sort();return this;},toString:function(){return"("+(this[_KEYS]||"")+")";}},{Item:null,create:function(key,item){return this.Item?new this.Item(key,item):item;},extend:function(_instance,_static){var klass=this.base(_instance);klass.create=this.create;if(_static)extend(klass,_static);if(!klass.Item){klass.Item=this.Item;}else if(typeof klass.Item!="function"){klass.Item=(this.Item||Base).extend(klass.Item);}if(klass.init)klass.init();return klass;}});var _RG_BACK_REF=/\\(\d+)/g,_RG_ESCAPE_CHARS=/\\./g,_RG_ESCAPE_BRACKETS=/\(\?[:=!]|\[[^\]]+\]/g,_RG_BRACKETS=/\(/g,_RG_LOOKUP=/\$(\d+)/,_RG_LOOKUP_SIMPLE=/^\$\d+$/;var RegGrp=Collection.extend({constructor:function(values,ignoreCase){this.base(values);this.ignoreCase=!!ignoreCase;},ignoreCase:false,exec:function(string,override){string+="";var items=this,keys=this[_KEYS];if(!keys.length)return string;if(override==RegGrp.IGNORE)override=0;return string.replace(new RegExp(this,this.ignoreCase?"gi":"g"),function(match){var item,offset=1,i=0;while((item=items[_HASH+keys[i++]])){var next=offset+item.length+1;if(arguments[offset]){var replacement=override==null?item.replacement:override;switch(typeof replacement){case"function":return replacement.apply(items,_slice.call(arguments,offset,next));case"number":return arguments[offset+replacement];default:return replacement;}}offset=next;}return match;});},insertAt:function(index,expression,replacement){if(instanceOf(expression,RegExp)){arguments[1]=expression.source;}return base(this,arguments);},test:function(string){return this.exec(string)!=string;},toString:function(){var offset=1;return"("+this.map(function(item){var expression=(item+"").replace(_RG_BACK_REF,function(match,index){return"\\"+(offset+Number(index));});offset+=item.length+1;return expression;}).join(")|(")+")";}},{IGNORE:"$0",init:function(){forEach("add,get,has,put,remove".split(","),function(name){_override(this,name,function(expression){if(instanceOf(expression,RegExp)){arguments[0]=expression.source;}return base(this,arguments);});},this.prototype);},Item:{constructor:function(expression,replacement){if(replacement==null)replacement=RegGrp.IGNORE;else if(replacement.replacement!=null)replacement=replacement.replacement;else if(typeof replacement!="function")replacement=String(replacement);if(typeof replacement=="string"&&_RG_LOOKUP.test(replacement)){if(_RG_LOOKUP_SIMPLE.test(replacement)){replacement=parseInt(replacement.slice(1));}else{var Q='"';replacement=replacement.replace(/\\/g,"\\\\").replace(/"/g,"\\x22").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\$(\d+)/g,Q+"+(arguments[$1]||"+Q+Q+")+"+Q).replace(/(['"])\1\+(.*)\+\1\1$/,"$1");replacement=new Function("return "+Q+replacement+Q);}}this.length=RegGrp.count(expression);this.replacement=replacement;this.toString=K(expression+"");},length:0,replacement:""},count:function(expression){expression=(expression+"").replace(_RG_ESCAPE_CHARS,"").replace(_RG_ESCAPE_BRACKETS,"");return match(expression,_RG_BRACKETS).length;}});var lang={name:"lang",version:base2.version,exports:"assert,assertArity,assertType,base,bind,copy,extend,forEach,format,instanceOf,match,pcopy,rescape,trim,typeOf",namespace:""};function assert(condition,message,ErrorClass){if(!condition){throw new(ErrorClass||Error)(message||"Assertion failed.");}};function assertArity(args,arity,message){if(arity==null)arity=args.callee.length;if(args.length<arity){throw new SyntaxError(message||"Not enough arguments.");}};function assertType(object,type,message){if(type&&(typeof type=="function"?!instanceOf(object,type):typeOf(object)!=type)){throw new TypeError(message||"Invalid type.");}};function copy(object){var copy={};for(var i in object){copy[i]=object[i];}return copy;};function pcopy(object){_dummy.prototype=object;return new _dummy;};function _dummy(){};function base(object,args){return object.base.apply(object,args);};function extend(object,source){if(object&&source){if(arguments.length>2){var key=source;source={};source[key]=arguments[2];}var proto=global[(typeof source=="function"?"Function":"Object")].prototype;if(base2.__prototyping){var i=_HIDDEN.length,key;while((key=_HIDDEN[--i])){var value=source[key];if(value!=proto[key]){if(_BASE.test(value)){_override(object,key,value)}else{object[key]=value;}}}}for(key in source){if(proto[key]===undefined){var value=source[key];if(key.charAt(0)=="@"){if(detect(key.slice(1)))extend(object,value);}else{var ancestor=object[key];if(ancestor&&typeof value=="function"){if(value!=ancestor){if(_BASE.test(value)){_override(object,key,value);}else{value.ancestor=ancestor;object[key]=value;}}}else{object[key]=value;}}}}}return object;};function _ancestorOf(ancestor,fn){while(fn){if(!fn.ancestor)return false;fn=fn.ancestor;if(fn==ancestor)return true;}return false;};function _override(object,name,method){var ancestor=object[name];var superObject=base2.__prototyping;if(superObject&&ancestor!=superObject[name])superObject=null;function _base(){var previous=this.base;this.base=superObject?superObject[name]:ancestor;var returnValue=method.apply(this,arguments);this.base=previous;return returnValue;};_base.method=method;_base.ancestor=ancestor;object[name]=_base;;;;_base.toString=K(method+"");};if(typeof StopIteration=="undefined"){StopIteration=new Error("StopIteration");}function forEach(object,block,context,fn){if(object==null)return;if(!fn){if(typeof object=="function"&&object.call){fn=Function;}else if(typeof object.forEach=="function"&&object.forEach!=arguments.callee){object.forEach(block,context);return;}else if(typeof object.length=="number"){_Array_forEach(object,block,context);return;}}_Function_forEach(fn||Object,object,block,context);};forEach.csv=function(string,block,context){forEach(csv(string),block,context);};forEach.detect=function(object,block,context){forEach(object,function(value,key){if(key.charAt(0)=="@"){if(detect(key.slice(1)))forEach(value,arguments.callee);}else block.call(context,value,key,object);});};function _Array_forEach(array,block,context){if(array==null)array=global;var length=array.length||0,i;if(typeof array=="string"){for(i=0;i<length;i++){block.call(context,array.charAt(i),i,array);}}else{for(i=0;i<length;i++){if(i in array)block.call(context,array[i],i,array);}}};function _Function_forEach(fn,object,block,context){var Temp=function(){this.i=1};Temp.prototype={i:1};var count=0;for(var i in new Temp)count++;_Function_forEach=(count>1)?function(fn,object,block,context){var processed={};for(var key in object){if(!processed[key]&&fn.prototype[key]===undefined){processed[key]=true;block.call(context,object[key],key,object);}}}:function(fn,object,block,context){for(var key in object){if(fn.prototype[key]===undefined){block.call(context,object[key],key,object);}}};_Function_forEach(fn,object,block,context);};function instanceOf(object,klass){if(typeof klass!="function"){throw new TypeError("Invalid 'instanceOf' operand.");}if(object==null)return false;if(object.constructor==klass)return true;if(klass.ancestorOf)return klass.ancestorOf(object.constructor);if(object instanceof klass)return true;if(Base.ancestorOf==klass.ancestorOf)return false;if(Base.ancestorOf==object.constructor.ancestorOf)return klass==Object;switch(klass){case Array:return!!(typeof object=="object"&&object.join&&object.splice);case Function:return typeOf(object)=="function";case RegExp:return typeof object.constructor.$1=="string";case Date:return!!object.getTimezoneOffset;case String:case Number:case Boolean:return typeOf(object)==typeof klass.prototype.valueOf();case Object:return true;}return false;};function typeOf(object){var type=typeof object;switch(type){case"object":return object==null?"null":typeof object.constructor=="undefined"?_MSIE_NATIVE_FUNCTION.test(object)?"function":type:typeof object.constructor.prototype.valueOf();case"function":return typeof object.call=="function"?type:"object";default:return type;}};var JavaScript={name:"JavaScript",version:base2.version,exports:"Array2,Date2,Function2,String2",namespace:"",bind:function(host){var top=global;global=host;forEach.csv(this.exports,function(name2){var name=name2.slice(0,-1);extend(host[name],this[name2]);this[name2](host[name].prototype);},this);global=top;return host;}};function _createObject2(Native,constructor,generics,extensions){var INative=Module.extend();var id=INative.toString().slice(1,-1);forEach.csv(generics,function(name){INative[name]=unbind(Native.prototype[name]);INative.namespace+=format("var %1=%2.%1;",name,id);});forEach(_slice.call(arguments,3),INative.implement,INative);var Native2=function(){return INative(this.constructor==INative?constructor.apply(null,arguments):arguments[0]);};Native2.prototype=INative.prototype;for(var name in INative){if(name!="prototype"&&Native[name]){delete INative.prototype[name];}Native2[name]=INative[name];}Native2.ancestor=Object;delete Native2.extend;Native2.namespace=Native2.namespace.replace(/(var (\w+)=)[^,;]+,([^\)]+)\)/g,"$1$3.$2");return Native2;};if((new Date).getYear()>1900){Date.prototype.getYear=function(){return this.getFullYear()-1900;};Date.prototype.setYear=function(year){return this.setFullYear(year+1900);};}var _testDate=new Date(Date.UTC(2006,1,20));_testDate.setUTCDate(15);if(_testDate.getUTCHours()!=0){forEach.csv("FullYear,Month,Date,Hours,Minutes,Seconds,Milliseconds",function(type){extend(Date.prototype,"setUTC"+type,function(){var value=base(this,arguments);if(value>=57722401000){value-=3600000;this.setTime(value);}return value;});});}Function.prototype.prototype={};if("".replace(/^/,K("$$"))=="$"){extend(String.prototype,"replace",function(expression,replacement){if(typeof replacement=="function"){var fn=replacement;replacement=function(){return String(fn.apply(null,arguments)).split("$").join("$$");};}return this.base(expression,replacement);});}var Array2=_createObject2(Array,Array,"concat,join,pop,push,reverse,shift,slice,sort,splice,unshift",Enumerable,{combine:function(keys,values){if(!values)values=keys;return Array2.reduce(keys,function(hash,key,index){hash[key]=values[index];return hash;},{});},contains:function(array,item){return Array2.indexOf(array,item)!=-1;},copy:function(array){var copy=_slice.call(array);if(!copy.swap)Array2(copy);return copy;},flatten:function(array){var i=0;return Array2.reduce(array,function(result,item){if(Array2.like(item)){Array2.reduce(item,arguments.callee,result);}else{result[i++]=item;}return result;},[]);},forEach:_Array_forEach,indexOf:function(array,item,fromIndex){var length=array.length;if(fromIndex==null){fromIndex=0;}else if(fromIndex<0){fromIndex=Math.max(0,length+fromIndex);}for(var i=fromIndex;i<length;i++){if(array[i]===item)return i;}return-1;},insertAt:function(array,index,item){Array2.splice(array,index,0,item);return item;},item:function(array,index){if(index<0)index+=array.length;return array[index];},lastIndexOf:function(array,item,fromIndex){var length=array.length;if(fromIndex==null){fromIndex=length-1;}else if(fromIndex<0){fromIndex=Math.max(0,length+fromIndex);}for(var i=fromIndex;i>=0;i--){if(array[i]===item)return i;}return-1;},map:function(array,block,context){var result=[];Array2.forEach(array,function(item,index){result[index]=block.call(context,item,index,array);});return result;},remove:function(array,item){var index=Array2.indexOf(array,item);if(index!=-1)Array2.removeAt(array,index);},removeAt:function(array,index){Array2.splice(array,index,1);},swap:function(array,index1,index2){if(index1<0)index1+=array.length;if(index2<0)index2+=array.length;var temp=array[index1];array[index1]=array[index2];array[index2]=temp;return array;}});Array2.reduce=Enumerable.reduce;Array2.like=function(object){return typeOf(object)=="object"&&typeof object.length=="number";};;;;Enumerable["#implemented_by"].pop();;;;Enumerable["#implemented_by"].push(Array2);var _DATE_PATTERN=/^((-\d+|\d{4,})(-(\d{2})(-(\d{2}))?)?)?T((\d{2})(:(\d{2})(:(\d{2})(\.(\d{1,3})(\d)?\d*)?)?)?)?(([+-])(\d{2})(:(\d{2}))?|Z)?$/;var _DATE_PARTS={FullYear:2,Month:4,Date:6,Hours:8,Minutes:10,Seconds:12,Milliseconds:14};var _TIMEZONE_PARTS={Hectomicroseconds:15,UTC:16,Sign:17,Hours:18,Minutes:20};var _TRIM_ZEROES=/(((00)?:0+)?:0+)?\.0+$/;var _TRIM_TIMEZONE=/(T[0-9:.]+)$/;var Date2=_createObject2(Date,function(yy,mm,dd,h,m,s,ms){switch(arguments.length){case 0:return new Date;case 1:return typeof yy=="number"?new Date(yy):Date2.parse(yy);default:return new Date(yy,mm,arguments.length==2?1:dd,h||0,m||0,s||0,ms||0);}},"",{toISOString:function(date){var string="####-##-##T##:##:##.###";for(var part in _DATE_PARTS){string=string.replace(/#+/,function(digits){var value=date["getUTC"+part]();if(part=="Month")value++;return("000"+value).slice(-digits.length);});}return string.replace(_TRIM_ZEROES,"").replace(_TRIM_TIMEZONE,"$1Z");}});delete Date2.forEach;Date2.now=function(){return(new Date).valueOf();};Date2.parse=function(string,defaultDate){if(arguments.length>1){assertType(defaultDate,"number","default date should be of type 'number'.")}var parts=match(string,_DATE_PATTERN);if(parts.length){if(parts[_DATE_PARTS.Month])parts[_DATE_PARTS.Month]--;if(parts[_TIMEZONE_PARTS.Hectomicroseconds]>=5)parts[_DATE_PARTS.Milliseconds]++;var date=new Date(defaultDate||0);var prefix=parts[_TIMEZONE_PARTS.UTC]||parts[_TIMEZONE_PARTS.Hours]?"UTC":"";for(var part in _DATE_PARTS){var value=parts[_DATE_PARTS[part]];if(!value)continue;date["set"+prefix+part](value);if(date["get"+prefix+part]()!=parts[_DATE_PARTS[part]]){return NaN;}}if(parts[_TIMEZONE_PARTS.Hours]){var hours=Number(parts[_TIMEZONE_PARTS.Sign]+parts[_TIMEZONE_PARTS.Hours]);var minutes=Number(parts[_TIMEZONE_PARTS.Sign]+(parts[_TIMEZONE_PARTS.Minutes]||0));date.setUTCMinutes(date.getUTCMinutes()+(hours*60)+minutes);}return date.valueOf();}else{return Date.parse(string);}};var String2=_createObject2(String,function(string){return new String(arguments.length==0?"":string);},"charAt,charCodeAt,concat,indexOf,lastIndexOf,match,replace,search,slice,split,substr,substring,toLowerCase,toUpperCase",{csv:csv,format:format,rescape:rescape,trim:trim});delete String2.forEach;function trim(string){return String(string).replace(_LTRIM,"").replace(_RTRIM,"");};function csv(string){return string?(string+"").split(/\s*,\s*/):[];};function format(string){var args=arguments;var pattern=new RegExp("%([1-"+(arguments.length-1)+"])","g");return(string+"").replace(pattern,function(match,index){return args[index];});};function match(string,expression){return(string+"").match(expression)||[];};function rescape(string){return(string+"").replace(_RESCAPE,"\\$1");};var Function2=_createObject2(Function,Function,"",{I:I,II:II,K:K,bind:bind,compose:compose,delegate:delegate,flip:flip,not:not,partial:partial,unbind:unbind});function I(i){return i;};function II(i,ii){return ii;};function K(k){return function(){return k;};};function bind(fn,context){var lateBound=typeof fn!="function";if(arguments.length>2){var args=_slice.call(arguments,2);return function(){return(lateBound?context[fn]:fn).apply(context,args.concat.apply(args,arguments));};}else{return function(){return(lateBound?context[fn]:fn).apply(context,arguments);};}};function compose(){var fns=_slice.call(arguments);return function(){var i=fns.length,result=fns[--i].apply(this,arguments);while(i--)result=fns[i].call(this,result);return result;};};function delegate(fn,context){return function(){var args=_slice.call(arguments);args.unshift(this);return fn.apply(context,args);};};function flip(fn){return function(){return fn.apply(this,Array2.swap(arguments,0,1));};};function not(fn){return function(){return!fn.apply(this,arguments);};};function partial(fn){var args=_slice.call(arguments,1);return function(){var specialised=args.concat(),i=0,j=0;while(i<args.length&&j<arguments.length){if(specialised[i]===undefined)specialised[i]=arguments[j++];i++;}while(j<arguments.length){specialised[i++]=arguments[j++];}if(Array2.contains(specialised,undefined)){specialised.unshift(fn);return partial.apply(null,specialised);}return fn.apply(this,specialised);};};function unbind(fn){return function(context){return fn.apply(context,_slice.call(arguments,1));};};function detect(){var jscript=NaN;var javaEnabled=global.java?true:false;if(global.navigator){var MSIE=/MSIE[\d.]+/g;var element=document.createElement("span");var userAgent=navigator.userAgent.replace(/([a-z])[\s\/](\d)/gi,"$1$2");if(!jscript)userAgent=userAgent.replace(MSIE,"");if(MSIE.test(userAgent))userAgent=userAgent.match(MSIE)[0]+" "+userAgent.replace(MSIE,"");base2.userAgent=navigator.platform+" "+userAgent.replace(/like \w+/gi,"");javaEnabled&=navigator.javaEnabled();}var _cache={};detect=function(expression){if(_cache[expression]==null){var returnValue=false,test=expression;var not=test.charAt(0)=="!";if(not)test=test.slice(1);if(test.charAt(0)=="("){try{returnValue=new Function("element,jscript,java,global","return !!"+test)(element,jscript,javaEnabled,global);}catch(ex){}}else{returnValue=new RegExp("("+test+")","i").test(base2.userAgent);}_cache[expression]=!!(not^returnValue);}return _cache[expression];};return detect(arguments[0]);};base2=global.base2=new Package(this,base2);var exports=this.exports;lang=new Package(this,lang);exports+=this.exports;JavaScript=new Package(this,JavaScript);eval(exports+this.exports);lang.base=base;lang.extend=extend;};